---
import { cva, type VariantProps } from "class-variance-authority";
import { titleCase as toTitleCase } from "title-case";
import type { BlogFrontmatterType } from "../content.config";
import Tag from "./Tag.astro";

export interface Props extends VariantProps<typeof cardVariants> {
  post: BlogFrontmatterType;
  path: string;
  className?: string;
}

const { post, path, size, className } = Astro.props;

let currentCoverUrl = "";
if (post?.covers && post.covers.length > 0) {
  currentCoverUrl = post.covers[0];
}

const tagsToUse = post.tags || [];

const cardVariants = cva("relative p-2 group", {
  variants: {
    size: {
      sm: "h-20",
      md: "h-32",
      lg: "h-40",
    },
  },
  defaultVariants: {
    size: "md",
  },
});

const imageVariants = cva(
  "bg-cover rounded-xl drop-shadow-md transition-all relative bg-center flex items-center justify-center bg-gray-100/35",
  {
    variants: {
      size: {
        sm: "h-16",
        md: "h-24 lg:h-20",
        lg: "h-32",
      },
      interactive: {
        true: "hover:brightness-90 hover:scale-105 duration-100 ease-in",
        false: "",
      },
    },
    defaultVariants: {
      size: "md",
      interactive: true,
    },
  },
);

const cardClass = cardVariants({ size, className });
const imageClass = imageVariants({ size, interactive: !!post });
const backgroundStyle = currentCoverUrl
  ? `background-image: url('${currentCoverUrl}')`
  : `background-color: rgb(90, 90, 90)`;
---

<div class={cardClass}>
  <a href={path} class="block">
    <div class={imageClass} style={backgroundStyle}>
      <div class="flex gap-1 absolute bottom-0 -left-2">
        {post.type && <Tag>{toTitleCase(post.type)}</Tag>}
        {
          tagsToUse.map((tag: string) => (
            <Tag key={tag}>{toTitleCase(tag)}</Tag>
          ))
        }
      </div>
      <Tag position="tr">{post.date}</Tag>
      <h1
        class="text-center text-sm sm:text-lg text-white font-bold"
        style="text-shadow: 0 0 14px rgba(0, 0, 0, 1)"
      >
        {post.title}
      </h1>
    </div>
  </a>
</div>
