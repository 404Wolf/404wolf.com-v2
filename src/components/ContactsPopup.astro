---
import { cva } from "class-variance-authority";
import contacts from "../content/contacts.json";

interface Props {
	open: boolean;
	id?: string;
}

const { open, id = "contacts-modal" } = Astro.props;

const styles = {
	dialog: cva([
		"p-6",
		"rounded-lg",
		"bg-slate-200",
		"max-w-2xl",
		"fixed",
		"top-1/2",
		"left-1/2",
		"transform",
		"-translate-x-1/2",
		"-translate-y-1/2",
	]),
	closeButton: cva([
		"absolute",
		"top-0",
		"right-0",
		"text-xl",
		"hover:bg-slate-100",
		"w-6",
		"h-6",
		"rounded",
		"flex",
		"items-center",
		"justify-center",
	]),
	title: cva(["text-2xl", "font-bold", "mb-4"]),
	grid: cva(["grid", "grid-cols-2", "gap-4"]),
	contactLink: cva([
		"relative",
		"flex",
		"items-center",
		"gap-3",
		"hover:scale-105",
		"transition-transform",
	]),
	iconContainer: cva(["relative", "flex-shrink-0"]),
	tag: cva([
		"absolute",
		"-bottom-2",
		"-left-2",
		"bg-slate-600",
		"text-white",
		"text-xs",
		"px-1",
		"py-p",
		"rounded",
		"z-10",
	]),
	icon: cva([
		"w-12",
		"h-12",
		"bg-slate-400",
		"rounded-2xl",
		"flex",
		"items-center",
		"justify-center",
	]),
	textContainer: cva([
		"bg-slate-50",
		"rounded-2xl",
		"pl-4",
		"pr-3",
		"py-2",
		"-ml-4",
		"-translate-x-5",
		"-z-10",
		"flex-1",
	]),
	text: cva(["text-sm", "font-semibold", "ml-4"]),
};
---

<dialog id={id} class={styles.dialog()} open={open}>
  <div class="relative">
    <button
      class={styles.closeButton()}
      onclick="this.closest('dialog').close()"
      autofocus
    >
      Ã—
    </button>

    <h2 class={styles.title()}>Contacts (say hi!)</h2>

    <div class={styles.grid()}>
      {
        contacts.map((contact) => (
          <a
            href={contact.link}
            target="_blank"
            rel="noopener noreferrer"
            class={styles.contactLink()}
          >
            <div class={styles.iconContainer()}>
              <div class={styles.tag()}>
                {contact.name}
              </div>

              <div class={styles.icon()}>
                <img
                  alt={contact.name}
                  src={`/icons/${contact.name.toLowerCase()}.svg`}
                  class="w-8 h-8"
                />
              </div>
            </div>

            <div class={styles.textContainer()}>
              <div class={styles.text()}>
                {contact.at ? "@" : ""}
                {contact.username}
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </div>
</dialog>

<script>
  const dialog = document.getElementById(
    "contacts-modal",
  ) as HTMLDialogElement | null;

  dialog?.addEventListener("click", (e) => {
    if (e.target === dialog) {
      dialog.close();
    }
  });
</script>

<style>
  dialog::backdrop {
    background: rgba(0, 0, 0, 0.5);
  }
</style>
