---
import BleedingBorder from "./BleedingBorder.astro";

interface Props {
    src: string;
    alt: string;
    className?: string;
}

const { src, alt, className = "" } = Astro.props;
const modalId = `zoom-modal-${src.replace(/[^a-zA-Z0-9]/g, "-")}`;
---

<BleedingBorder>
    <img
        src={src}
        alt={alt}
        class={`cursor-pointer ${className}`}
        data-zoom-trigger={modalId}
    />

    <!-- By default, the modal is hidden -->
    <div
        id={modalId}
        class="zoom-modal fixed inset-0 backdrop-blur-sm items-center justify-center z-50 hidden"
    >
        <div class="relative max-h-screen-lg p-4">
            <img
                src={src}
                alt={alt}
                class="max-w-full max-h-full object-contain"
                data-zoom-content
            />
        </div>
    </div>
</BleedingBorder>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const triggers = document.querySelectorAll("[data-zoom-trigger]");

        for (const trigger of triggers) {
            trigger.addEventListener("click", () => {
                const modalId = trigger.getAttribute("data-zoom-trigger");
                const modal = modalId ? document.getElementById(modalId) : null;
                modal?.classList.remove("hidden");
                modal?.classList.add("flex");
            });
        }

        const modals = document.querySelectorAll(".zoom-modal");
        for (const modal of modals) {
            modal.addEventListener("click", () => {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
            });
        }

        document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
                const modals = document.querySelectorAll(".zoom-modal");
                for (const modal of modals) {
                    modal.classList.add("hidden");
                    modal.classList.remove("flex");
                }
            }
        });
    });
</script>
